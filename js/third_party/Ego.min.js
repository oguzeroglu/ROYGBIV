(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Ego=a.Ego||{})})(this,function(a){'use strict';var b=Math.sqrt,c=function(){this._booleanMap={},this._numericalMap={},this._vectorMap={}};c.prototype.clone=function(){var a=new c;for(var b in this._booleanMap)a.addBooleanInformation(b,this.getBooleanInformation(b));for(var b in this._numericalMap)a.addNumericalInformation(b,this.getNumericalInformation(b));for(var b in this._vectorMap){var d=this.getVectorInformation(b);a.addVectorInformation(b,d.x,d.y,d.z)}return a},c.prototype.addBooleanInformation=function(a,b){return!this._hasBooleanInformation(a)&&(this._booleanMap[a]=!!b,!0)},c.prototype.addNumericalInformation=function(a,b){if(this._hasNumericalInformation(a))return!1;var c=parseFloat(b);return!isNaN(c)&&(this._numericalMap[a]=c,!0)},c.prototype.addVectorInformation=function(a,c,d,e){if(this._hasVectorInformation(a))return!1;var f=parseFloat(c),g=parseFloat(d),h=parseFloat(e);if(isNaN(f)||isNaN(g)||isNaN(h))return!1;return this._vectorMap[a]={x:f,y:g,z:h,length:b(f*f+g*g+h*h),isVector:!0},!0},c.prototype.getBooleanInformation=function(a){return this._hasBooleanInformation(a)?this._booleanMap[a]:null},c.prototype.getNumericalInformation=function(a){return this._hasNumericalInformation(a)?this._numericalMap[a]:null},c.prototype.getVectorInformation=function(a){return this._hasVectorInformation(a)?this._vectorMap[a]:null},c.prototype.updateBooleanInformation=function(a,b){return!!this._hasBooleanInformation(a)&&(this._booleanMap[a]=!!b,!0)},c.prototype.updateNumericalInformation=function(a,b){if(!this._hasNumericalInformation(a))return!1;var c=parseFloat(b);return!isNaN(c)&&(this._numericalMap[a]=c,!0)},c.prototype.updateVectorInformation=function(a,c,d,e){if(!this._hasVectorInformation(a))return!1;var f=parseFloat(c),g=parseFloat(d),h=parseFloat(e);if(isNaN(f)||isNaN(g)||isNaN(h))return!1;var i=this._vectorMap[a];return i.x=f,i.y=g,i.z=h,i.length=b(f*f+g*g+h*h),!0},c.prototype.deleteBooleanInformation=function(a){return!!this._hasBooleanInformation(a)&&(delete this._booleanMap[a],!0)},c.prototype.deleteNumericalInformation=function(a){return!!this._hasNumericalInformation(a)&&(delete this._numericalMap[a],!0)},c.prototype.deleteVectorInformation=function(a){return!!this._hasVectorInformation(a)&&(delete this._vectorMap[a],!0)},c.prototype._hasBooleanInformation=function(a){return"undefined"!=typeof this._booleanMap[a]},c.prototype._hasNumericalInformation=function(a){return"undefined"!=typeof this._numericalMap[a]},c.prototype._hasVectorInformation=function(a){return"undefined"!=typeof this._vectorMap[a]};var d=function(a){this._parameter=a};d.prototype.updateParameter=function(a){this._parameter=a},d.prototype.perform=function(){return!0},d.prototype.clone=function(){var a=this._parameter&&this._parameter.clone?this._parameter.clone():this._parameter;return new this.constructor(a)};var e=function(){d.call(this,null)};e.prototype=Object.create(d.prototype),e.prototype.perform=function(a){return!0==a},Object.defineProperty(e.prototype,"constructor",{value:e,enumerable:!1,writable:!0});var f=function(){d.call(this,null)};f.prototype=Object.create(d.prototype),f.prototype.perform=function(a){return!1==a},Object.defineProperty(f.prototype,"constructor",{value:f,enumerable:!1,writable:!0});var g=function(a){d.call(this,a)};g.prototype=Object.create(d.prototype),g.prototype.perform=function(a){var b=this._parameter;return a.isVector?b.testNumber(a.length):b.testNumber(a)},Object.defineProperty(g.prototype,"constructor",{value:g,enumerable:!1,writable:!0});var h=function(a,b){this._isLowerBoundInclusive=!0,this._isUpperBoundInclusive=!0,this._lowerBound=a,this._upperBound=b};h.prototype.clone=function(){var a=new h(this._lowerBound,this._upperBound);return this._isLowerBoundInclusive?a.makeLowerBoundInclusive():a.makeLowerBoundExclusive(),this._isUpperBoundInclusive?a.makeUpperBoundInclusive():a.makeUpperBoundExclusive(),a},h.prototype.makeLowerBoundInclusive=function(){this._isLowerBoundInclusive=!0},h.prototype.makeLowerBoundExclusive=function(){this._isLowerBoundInclusive=!1},h.prototype.makeUpperBoundInclusive=function(){this._isUpperBoundInclusive=!0},h.prototype.makeUpperBoundExclusive=function(){this._isUpperBoundInclusive=!1},h.prototype.updateLowerBound=function(a){this._lowerBound=a},h.prototype.updateUpperBound=function(a){this._upperBound=a},h.prototype.testNumber=function(a){var b=this._lowerBound,c=this._upperBound;if(this._isUpperBoundInclusive){if(a>c)return!1;}else if(a>=c)return!1;if(this._isLowerBoundInclusive){if(a<b)return!1;}else if(a<=b)return!1;return!0};var i={TYPE_BOOLEAN:"TYPE_BOOLEAN",TYPE_NUMERICAL:"TYPE_NUMERICAL",TYPE_VECTOR:"TYPE_VECTOR"},j=function(a,b,c){this._informationName=a,this._informationType=b,this._decisionMethod=c,this._yesNode=null,this._noNode=null};j.prototype.clone=function(){var a=new j(this._informationName,this._informationType,this._decisionMethod.clone()),b=this.getYesNode(),c=this.getNoNode();return b instanceof j?a.setYesNode(b.clone()):a.setYesNode(b),c instanceof j?a.setNoNode(c.clone()):a.setNoNode(c),a},j.prototype.setYesNode=function(a){this._yesNode=a},j.prototype.getYesNode=function(){return this._yesNode},j.prototype.setNoNode=function(a){this._noNode=a},j.prototype.getNoNode=function(){return this._noNode},j.prototype.make=function(a){var b=this._informationType,c=this._informationName,d=null;if(b==i.TYPE_BOOLEAN)d=a.getBooleanInformation(c);else if(b==i.TYPE_NUMERICAL)d=a.getNumericalInformation(c);else if(b==i.TYPE_VECTOR)d=a.getVectorInformation(c);else throw new Error("No such information type.");if(null==d)throw new Error("No such information in knowledge: "+c);return this._decisionMethod.perform(d)?this._yesNode:this._noNode};var k=function(a){if(!(a instanceof j))throw new Error("Root node must be an instance of Ego.Decision");this._rootNode=a};k.prototype.makeDecision=function(a){for(var b=this._rootNode;b instanceof j;)b=b.make(a);return b},k.prototype.clone=function(){return new k(this._rootNode.clone())};var l=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})},m=function(a){this._name=a,this._id=l(),this._parent=null};m.prototype.clone=function(){return new m(this.getName())},m.prototype.setParent=function(a){return!this._parent&&(this._parent=a,!0)},m.prototype.removeParent=function(){this._parent=null},m.prototype.getID=function(){return this._id},m.prototype.getParent=function(){return this._parent},m.prototype.getName=function(){return this._name};var n=function(a,b,c,d,e){j.call(this,c,d,e),this.setYesNode(b),this.setNoNode(a)};n.prototype=Object.create(j.prototype),n.prototype.clone=function(a,b,c,d){var e=null,f=null;return e=a?a:this.getSourceNode().clone(c||null,d||null),f=b?b:this.getTargetNode().clone(c||null,d||null),new n(e,f,this._informationName,this._informationType,this._decisionMethod.clone())},n.prototype.isPossible=function(a){var b=this.make(a);return!(b!=this._yesNode)},n.prototype.getSourceNode=function(){return this.getNoNode()},n.prototype.getTargetNode=function(){return this.getYesNode()},Object.defineProperty(n.prototype,"constructor",{value:n,enumerable:!1,writable:!0});var o=function(a,b){m.call(this,a),this._knowledge=b,this._statesByID={},this._transitionsByStateID={},this._stateChangedCallbackFunction=null,this._entryState=null,this._currentState=null};o.prototype=Object.create(m.prototype),o.prototype.clone=function(a,b){var c=new o(this.getName(),a||this._knowledge.clone()),d=b||{};for(var e in this._statesByID){var f=this._statesByID[e],g=d[e]||f.clone(a||null,d);c.addState(g),d[e]=g,this._entryState==f&&c.setEntryState(g)}for(var e in this._transitionsByStateID)for(var h=this._transitionsByStateID[e],j=0;j<h.length;j++){var k=h[j],l=k.getSourceNode(),m=k.getTargetNode(),n=d[l.getID()]||null,p=d[m.getID()]||null,g=k.clone(n,p,a||null,d);c.addTransition(g),d[l.getID()]=g.getSourceNode(),d[m.getID()]=g.getTargetNode()}return c},o.prototype.hasState=function(a){if(a.getID()==this.getID())return!0;var b=!1;for(var c in this._statesByID){var d=this._statesByID[c];b=b||d.getID()==a.getID(),d instanceof o&&(b=b||d.hasState(a))}return b},o.prototype.addState=function(a){return!(a instanceof o&&a.hasState(this))&&!!a.setParent(this)&&(this._statesByID[a.getID()]=a,this._transitionsByStateID[a.getID()]=[],!0)},o.prototype.removeState=function(a){if(a.getParent()!=this)return!1;if(this._currentState&&this._currentState.getID()==a.getID())throw new Error("Cannot remove the active state.");return this._entryState&&this._entryState.getID()==a.getID()&&(this._entryState=null),a.removeParent(),delete this._statesByID[a.getID()],delete this._transitionsByStateID[a.getID()],!0},o.prototype.addTransition=function(a){var b=a.getSourceNode();if(b.getParent()==this){for(var c,d=this._transitionsByStateID[b.getID()],e=0;e<d.length;e++)if(c=d[e],c.getTargetNode()==a.getTargetNode())return!1;return d.push(a),!0}return!1},o.prototype.removeTransition=function(a){var b=a.getSourceNode();if(b.getParent()==this){for(var c=this._transitionsByStateID[b.getID()],d=null,e=0;e<c.length;e++)if(c[e].getTargetNode()==a.getTargetNode()){d=e;break}return null!=d&&(c.splice(d,1),!0)}return!1},o.prototype.setEntryState=function(a){return!!this._statesByID[a.getID()]&&(this._entryState=a,!0)},o.prototype.onStateChanged=function(a){this._stateChangedCallbackFunction=a},o.prototype.reset=function(){this._currentState=null},o.prototype.onCrossHierarchyTransition=function(a){this._changeState(a),this.update()},o.prototype._onNewState=function(a){this._stateChangedCallbackFunction&&this._stateChangedCallbackFunction(a)},o.prototype._getNextState=function(a){if(null==a)return null;for(var b,c=this._transitionsByStateID[a.getID()],d=this._knowledge,e=0;e<c.length;e++)if(b=c[e],b.isPossible(d))return b;return null},o.prototype._changeState=function(a){this._currentState&&this._currentState instanceof o&&this._currentState.reset(),this._currentState=a,this._onNewState(a)},o.prototype.update=function(){if(!this._entryState)throw new Error("Entry state not set. Cannot update the StateMachine.");this._currentState||this._changeState(this._entryState);for(var a=this._getNextState(this._currentState);a;){var b=a.getTargetNode(),c=b.getParent();c==this?this._changeState(a.getTargetNode()):(null!=c&&c.onCrossHierarchyTransition(b),this.reset()),a=this._getNextState(this._currentState)}this._currentState instanceof o&&this._currentState.update()},Object.defineProperty(o.prototype,"constructor",{value:o,enumerable:!1,writable:!0}),a.Knowledge=c,a.DecisionMethod=d,a.IsTrue=e,a.IsFalse=f,a.IsInRange=g,a.Range=h,a.Decision=j,a.InformationTypes=i,a.DecisionTree=k,a.State=m,a.Transition=n,a.StateMachine=o,Object.defineProperty(a,"__esModule",{value:!0})});